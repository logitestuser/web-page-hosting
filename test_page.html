<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Test_Webpage</title>
    <link rel="icon" href="data:,">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .main-container {
            display: flex;
            gap: 30px;
            margin-top: 20px;
        }

        .left-content {
            flex: 1;
        }

        .video-section {
            flex: 1;
            min-width: 400px;
        }

        .video-container-main {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .video-player-main {
            flex: 2;
        }

        .video-title-main {
            background: #007bff;
            color: white;
            padding: 10px 15px;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
            font-size: 16px;
            text-align: center;
            margin-bottom: 0;
        }

        #videoMain {
            width: 100%;
            max-width: 560px;
            height: 315px;
            background: #000;
            border-radius: 0 0 8px 8px;
        }

        .playlist-container-main {
            flex: 1;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            min-width: 200px;
        }

        .playlist-title-main {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        #playlistMain {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #playlistMain li {
            padding: 8px;
            margin: 3px 0;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        #playlistMain li:hover {
            background: #e9ecef;
        }

        #playlistMain li.active {
            background: #007bff;
            color: white;
            border-color: #0056b3;
            font-weight: bold;
        }

        .controls-main {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .control-button-main {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 70px;
        }

        #btnPlayPauseMain {
            background: #28a745;
            color: white;
        }

        #btnPlayPauseMain:hover {
            background: #218838;
        }

        #btnPlayPauseMain.paused {
            background: #dc3545;
        }

        #btnPrevMain, #btnNextMain {
            background: #007bff;
            color: white;
        }

        #btnPrevMain:hover, #btnNextMain:hover {
            background: #0056b3;
        }

        #btnPrevMain:disabled, #btnNextMain:disabled {
            background: #6c757d;
            color: #adb5bd;
            cursor: not-allowed;
            opacity: 0.6;
        }

        #btnMuteMain {
            background: #ffc107;
            color: #212529;
        }

        #btnMuteMain:hover {
            background: #e0a800;
        }

        #btnMuteMain.muted {
            background: #dc3545;
            color: white;
        }

        .status-footer {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-top: 30px;
        }

        .status-grid-main {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
        }

        .status-item-main {
            background: white;
            padding: 8px;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }

        .status-label-main {
            font-weight: bold;
            font-size: 10px;
            color: #666;
            text-transform: uppercase;
        }

        .status-value-main {
            font-size: 14px;
            color: #333;
            margin-top: 3px;
        }

        .action-log-main {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 8px;
            max-height: 100px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .log-entry-main {
            padding: 2px 0;
            border-bottom: 1px solid #eee;
            font-family: monospace;
            font-size: 10px;
        }

        .log-entry-main:last-child {
            border-bottom: none;
        }

        .log-timestamp-main {
            color: #666;
        }

        .log-action-main {
            color: #007bff;
            font-weight: bold;
        }
    </style>
</head>
<body>

<script>
    function launchGoogle(){
        window.open("https://www.google.com/","_self");
    }
    function openImage(){
        window.open('https://i.imgur.com/pMv3F6f.png', '_self');
    }
    function updateValue1() {
        document.getElementById('text_field1').setAttribute('value', document.getElementById('text_field1').value);
    }
    function updateValue2() {
        document.getElementById('text_field2').setAttribute('value', document.getElementById('text_field2').value);
    }
    window.oncontextmenu = function () {
        document.getElementById("secondaryClick").value = "Secondary Click worked";
    }
    document.onclick = function() {myFunction()};
    function myFunction() {
        document.getElementById("tapToClick").value = "Tap to Click worked";
    }
</script>

<center><h1>Automation Test Webpage</h1></center>

<div class="main-container">
    <div class="left-content">
        <center>
            <table>
                <tr>
                    <td>
                        <p>
                        <h3>Dropdown Sample: </h3></p>
                    </td>
                    <td>
                        <select id="dropdown">
                            <option value="">Dropdown1</option>
                            <option value="">Dropdown2</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <h3> Enter First String : </h3>
                    </td>
                    <td>
                        <input type="text" id="text_field1" size="15" maxlength="15" value="" onkeyup=updateValue1()>
                    </td>
                </tr>
                <tr>
                    <td>
                        <h3> Enter Second String : </h3>
                    </td>
                    <td>
                        <input type="text" id="text_field2" size="15" maxlength="15" value="" onkeyup=updateValue2()>
                    </td>
                </tr>
                <tr>
                    <td>
                        <h3> Open new webpage : </h3>
                    </td>
                    <td>
                        <input type="button" id="launch" value="Open" onclick=launchGoogle()>
                    </td>
                </tr>
                <tr>
                    <td>
                        <h3> Open a image: </h3>
                    </td>
                    <td>
                        <input type="button" id="openimage" value="Open Image" onclick=openImage()>
                    </td>
                </tr>
                <tr>
                    <td>
                        <h3>Do a Left Click/Tap on touchpad</h3>
                    </td>
                    <td>
                        <input type="text" id="tapToClick" value="">
                    </td>
                </tr>
                <tr>
                    <td>
                        <h3>Do a Right Click on Mouse/Secondary click on touchpad</h3>
                    </td>
                    <td>
                        <input type="text" id="secondaryClick" value="">
                    </td>
                </tr>
            </table>
        </center>
    </div>

    <div class="video-section">
        <div class="video-container-main">
            <div class="video-player-main">
                <video id="videoMain" controls>
                    Your browser does not support the video tag.
                </video>
            </div>

            <div class="playlist-container-main">
                <div class="playlist-title-main">Playlist (5 Videos)</div>
                <ul id="playlistMain">
                    <li data-src="./video_1.mov" data-title="Video 1">&#127916; Test Video 1</li>
                    <li data-src="./video_2.mov" data-title="Video 2">&#127916; Test Video 2</li>
                    <li data-src="./video_3.mov" data-title="Video 3">&#127916; Test Video 3</li>
                    <li data-src="./video_4.mov" data-title="Video 4">&#127916; Test Video 4</li>
                    <li data-src="./video_5.mov" data-title="Video 5">&#127916; Test Video 5</li>
                </ul>
            </div>
        </div>

        <div class="controls-main">
            <button id="btnPrevMain" class="control-button-main">&#9198;&#65039; Previous</button>
            <button id="btnPlayPauseMain" class="control-button-main">&#9654;&#65039; Play</button>
            <button id="btnNextMain" class="control-button-main">&#9197;&#65039; Next</button>
            <button id="btnMuteMain" class="control-button-main">&#128266; Mute</button>
        </div>
    </div>
</div>

<div class="status-footer">
    <h3>Device Action Status</h3>
    <div class="status-grid-main">
        <div class="status-item-main">
            <div class="status-label-main">Current Video</div>
            <div class="status-value-main" id="currentVideoStatusMain">Not loaded</div>
        </div>
        <div class="status-item-main">
            <div class="status-label-main">Playback State</div>
            <div class="status-value-main" id="playbackStatusMain">Paused</div>
        </div>
        <div class="status-item-main">
            <div class="status-label-main">Audio State</div>
            <div class="status-value-main" id="audioStatusMain">Unmuted</div>
        </div>
        <div class="status-item-main">
            <div class="status-label-main">Video Progress</div>
            <div class="status-value-main" id="progressStatusMain">0:00 / 0:00</div>
        </div>
        <div class="status-item-main">
            <div class="status-label-main">Last Action</div>
            <div class="status-value-main" id="lastActionStatusMain">None</div>
        </div>
        <div class="status-item-main">
            <div class="status-label-main">External Device Events</div>
            <div class="status-value-main" id="deviceEventStatusMain">0</div>
        </div>
    </div>

    <div class="action-log-main" id="actionLogMain">
        <div class="log-entry-main">
            <span class="log-timestamp-main">[Ready]</span>
            <span class="log-action-main">System initialized - Ready for testing</span>
        </div>
    </div>
</div>

<script>
    // Video Player JavaScript
    // DOM Elements
    const videoMain = document.getElementById('videoMain');
    const itemsMain = Array.from(document.querySelectorAll('#playlistMain li'));
    const btnPrevMain = document.getElementById('btnPrevMain');
    const btnNextMain = document.getElementById('btnNextMain');
    const btnPlayPauseMain = document.getElementById('btnPlayPauseMain');
    const btnMuteMain = document.getElementById('btnMuteMain');

    // Status Elements
    const currentVideoStatusMain = document.getElementById('currentVideoStatusMain');
    const playbackStatusMain = document.getElementById('playbackStatusMain');
    const audioStatusMain = document.getElementById('audioStatusMain');
    const progressStatusMain = document.getElementById('progressStatusMain');
    const lastActionStatusMain = document.getElementById('lastActionStatusMain');
    const deviceEventStatusMain = document.getElementById('deviceEventStatusMain');
    const actionLogMain = document.getElementById('actionLogMain');

    // State Variables
    let currentIndexMain = 0;
    let actionCountMain = 0;
    let deviceEventCountMain = 0;
    let mediaSessionSupportedMain = false;
    let isInitializedMain = false;

    // Utility Functions
    function formatTimeMain(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    function logActionMain(action, details = '', isDeviceEvent = false) {
        actionCountMain++;
        if (isDeviceEvent) {
            deviceEventCountMain++;
            deviceEventStatusMain.textContent = deviceEventCountMain;
        }

        const timestamp = new Date().toLocaleTimeString();
        const logEntry = document.createElement('div');
        logEntry.className = 'log-entry-main';
        logEntry.innerHTML = `
            <span class="log-timestamp-main">[${timestamp}]</span>
            <span class="log-action-main">${isDeviceEvent ? '\u{1F3AE} ' : ''}${action}</span>
            ${details ? ` - ${details}` : ''}
        `;

        actionLogMain.insertBefore(logEntry, actionLogMain.firstChild);

        // Keep only last 10 entries
        while (actionLogMain.children.length > 10) {
            actionLogMain.removeChild(actionLogMain.lastChild);
        }

        // Update status
        lastActionStatusMain.textContent = action;
    }

    function updateStatusMain() {
        // Update all status displays
        const isPlaying = !videoMain.paused && !videoMain.ended;
        playbackStatusMain.textContent = isPlaying ? 'Playing' : 'Paused';
        audioStatusMain.textContent = videoMain.muted ? 'Muted' : 'Unmuted';

        // Update button states
        btnPlayPauseMain.textContent = isPlaying ? '\u23F8\uFE0F Pause' : '\u25B6\uFE0F Play';
        btnPlayPauseMain.classList.toggle('paused', !isPlaying);

        if (videoMain.duration) {
            const current = formatTimeMain(videoMain.currentTime);
            const total = formatTimeMain(videoMain.duration);
            progressStatusMain.textContent = `${current} / ${total}`;
        }

        // Update Media Session if supported
        updateMediaSessionPlaybackStateMain();
    }

    function updateNavigationButtonsMain() {
        // Disable previous button on first video
        btnPrevMain.disabled = (currentIndexMain === 0);

        // Disable next button on last video
        btnNextMain.disabled = (currentIndexMain === itemsMain.length - 1);

        // Update Media Session navigation availability
        if (mediaSessionSupportedMain) {
            try {
                if (currentIndexMain === 0) {
                    navigator.mediaSession.setActionHandler('previoustrack', null);
                } else {
                    navigator.mediaSession.setActionHandler('previoustrack', () => {
                        logActionMain('DEVICE_PREV', 'External previous track command', true);
                        prevTrackMain();
                    });
                }

                if (currentIndexMain === itemsMain.length - 1) {
                    navigator.mediaSession.setActionHandler('nexttrack', null);
                } else {
                    navigator.mediaSession.setActionHandler('nexttrack', () => {
                        logActionMain('DEVICE_NEXT', 'External next track command', true);
                        nextTrackMain();
                    });
                }
            } catch (e) {
                logActionMain('MEDIA_SESSION_WARN', 'Error updating navigation handlers');
            }
        }

        logActionMain('NAV_UPDATE', `Prev: ${btnPrevMain.disabled ? 'disabled' : 'enabled'}, Next: ${btnNextMain.disabled ? 'disabled' : 'enabled'}`);
    }

    // Media Session API Integration
    function initializeMediaSessionMain() {
        if ('mediaSession' in navigator) {
            mediaSessionSupportedMain = true;
            logActionMain('MEDIA_SESSION_INIT', 'External device controls enabled');

            // Set up action handlers for external device controls
            navigator.mediaSession.setActionHandler('play', () => {
                logActionMain('DEVICE_PLAY', 'External play command', true);
                handlePlayMain();
            });

            navigator.mediaSession.setActionHandler('pause', () => {
                logActionMain('DEVICE_PAUSE', 'External pause command', true);
                handlePauseMain();
            });

            navigator.mediaSession.setActionHandler('stop', () => {
                logActionMain('DEVICE_STOP', 'External stop command', true);
                handlePauseMain();
            });

        } else {
            logActionMain('MEDIA_SESSION_ERROR', 'Browser does not support Media Session API');
        }
    }

    function updateMediaSessionMetadataMain() {
        if (mediaSessionSupportedMain && itemsMain[currentIndexMain]) {
            const item = itemsMain[currentIndexMain];
            navigator.mediaSession.metadata = new MediaMetadata({
                title: item.dataset.title,
                artist: 'Test Playlist',
                album: 'Device Control Testing',
                artwork: [
                    { src: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="96" height="96"><rect width="96" height="96" fill="%23007bff"/><text x="48" y="55" text-anchor="middle" fill="white" font-size="40">&#127916;</text></svg>', sizes: '96x96', type: 'image/svg+xml' }
                ]
            });
        }
    }

    function updateMediaSessionPlaybackStateMain() {
        if (mediaSessionSupportedMain) {
            navigator.mediaSession.playbackState = videoMain.paused ? 'paused' : 'playing';
        }
    }

    // Core Functions
    function loadAndPlayMain(index) {
        currentIndexMain = index;

        // Update playlist visual state
        itemsMain.forEach(li => li.classList.remove('active'));
        const item = itemsMain[currentIndexMain];
        item.classList.add('active');

        // Load video
        const videoTitle = item.dataset.title;
        const videoSrc = item.dataset.src;

        videoMain.src = videoSrc;
        currentVideoStatusMain.textContent = videoTitle;

        logActionMain('VIDEO_LOADED', `${videoTitle} (${index + 1}/${itemsMain.length})`);

        // Update Media Session metadata
        updateMediaSessionMetadataMain();

        // Update navigation button states
        updateNavigationButtonsMain();

        // Auto-play only if not first initialization
        if (isInitializedMain) {
            handlePlayMain();
        }
    }

    function handlePlayMain() {
        videoMain.play().then(() => {
            logActionMain('PLAY_SUCCESS', 'Video playing');
            updateStatusMain();
        }).catch(err => {
            logActionMain('PLAY_ERROR', err.message);
            console.error('Play failed:', err);
        });
    }

    function handlePauseMain() {
        videoMain.pause();
        logActionMain('PAUSE_SUCCESS', 'Video paused');
        updateStatusMain();
    }

    function playPauseMain() {
        if (videoMain.paused || videoMain.ended) {
            handlePlayMain();
        } else {
            handlePauseMain();
        }
    }

    function prevTrackMain() {
        if (currentIndexMain > 0) {
            const oldIndex = currentIndexMain;
            const newIndex = currentIndexMain - 1;
            loadAndPlayMain(newIndex);
            logActionMain('PREV_TRACK', `From video ${oldIndex + 1} to ${newIndex + 1}`);
        } else {
            logActionMain('PREV_BLOCKED', 'Already at first video');
        }
    }

    function nextTrackMain() {
        if (currentIndexMain < itemsMain.length - 1) {
            const oldIndex = currentIndexMain;
            const newIndex = currentIndexMain + 1;
            loadAndPlayMain(newIndex);
            logActionMain('NEXT_TRACK', `From video ${oldIndex + 1} to ${newIndex + 1}`);
        } else {
            logActionMain('NEXT_BLOCKED', 'Already at last video');
        }
    }

    function muteUnmuteMain() {
        videoMain.muted = !videoMain.muted;

        if (videoMain.muted) {
            btnMuteMain.textContent = '\u{1F507} Unmute';
            btnMuteMain.classList.add('muted');
            logActionMain('MUTE_ACTION', 'Audio muted');
        } else {
            btnMuteMain.textContent = '\u{1F50A} Mute';
            btnMuteMain.classList.remove('muted');
            logActionMain('UNMUTE_ACTION', 'Audio unmuted');
        }
    }
    
    // Event Listeners
    
    // Button Events
    btnPlayPauseMain.addEventListener('click', playPauseMain);
    btnPrevMain.addEventListener('click', prevTrackMain);
    btnNextMain.addEventListener('click', nextTrackMain);
    btnMuteMain.addEventListener('click', muteUnmuteMain);
    
    // Playlist Events
    itemsMain.forEach((li, idx) => {
        li.addEventListener('click', () => {
            loadAndPlayMain(idx);
            logActionMain('PLAYLIST_CLICK', `Selected video ${idx + 1}`);
        });
    });
    
    // Video Events
    videoMain.addEventListener('loadstart', () => {
        logActionMain('VIDEO_LOAD_START', 'Video loading started');
        updateStatusMain();
    });
    
    videoMain.addEventListener('loadedmetadata', () => {
        logActionMain('VIDEO_METADATA', `Duration: ${formatTimeMain(videoMain.duration)}`);
        updateStatusMain();
    });
    
    videoMain.addEventListener('play', () => {
        logActionMain('VIDEO_PLAY_EVENT', 'Play event fired');
        updateStatusMain();
    });
    
    videoMain.addEventListener('pause', () => {
        logActionMain('VIDEO_PAUSE_EVENT', 'Pause event fired');
        updateStatusMain();
    });
    
    videoMain.addEventListener('timeupdate', () => updateStatusMain());
    videoMain.addEventListener('volumechange', () => updateStatusMain());
    
    videoMain.addEventListener('ended', () => {
        logActionMain('VIDEO_ENDED', 'Auto-playing next video');
        nextTrackMain();
    });
    
    videoMain.addEventListener('error', (e) => {
        logActionMain('VIDEO_ERROR', `Error loading video: ${e.message || 'Unknown error'}`);
    });
    
    // Keyboard Events for Device Testing
    document.addEventListener('keydown', (e) => {
        // Only handle if video section is focused or no other input is focused
        const activeElement = document.activeElement;
        const isInputFocused = activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 'SELECT' || activeElement.tagName === 'TEXTAREA');
        
        if (!isInputFocused) {
            switch (e.code) {
                case 'Space':
                    e.preventDefault();
                    playPauseMain();
                    logActionMain('KEYBOARD_SPACE', 'Play/Pause via keyboard');
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    prevTrackMain();
                    logActionMain('KEYBOARD_LEFT', 'Previous via keyboard');
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    nextTrackMain();
                    logActionMain('KEYBOARD_RIGHT', 'Next via keyboard');
                    break;
                case 'KeyM':
                    e.preventDefault();
                    muteUnmuteMain();
                    logActionMain('KEYBOARD_M', 'Mute/Unmute via keyboard');
                    break;
            }
        }
    });
    
    // Global Functions for Automation Testing
    window.getVideoStateMain = function() {
        return {
            currentIndex: currentIndexMain,
            currentVideo: itemsMain[currentIndexMain]?.dataset.title || 'None',
            isPlaying: !videoMain.paused && !videoMain.ended,
            isMuted: videoMain.muted,
            currentTime: videoMain.currentTime,
            duration: videoMain.duration,
            actionCount: actionCountMain,
            deviceEventCount: deviceEventCountMain,
            mediaSessionSupported: mediaSessionSupportedMain
        };
    };
    
    window.simulateDeviceActionMain = function(action) {
        switch (action.toLowerCase()) {
            case 'play':
                handlePlayMain();
                logActionMain('SIMULATE_PLAY', 'Simulated play action', true);
                break;
            case 'pause':
                handlePauseMain();
                logActionMain('SIMULATE_PAUSE', 'Simulated pause action', true);
                break;
            case 'playpause':
                playPauseMain();
                logActionMain('SIMULATE_PLAYPAUSE', 'Simulated play/pause toggle', true);
                break;
            case 'prev':
            case 'previous':
                prevTrackMain();
                logActionMain('SIMULATE_PREV', 'Simulated previous action', true);
                break;
            case 'next':
                nextTrackMain();
                logActionMain('SIMULATE_NEXT', 'Simulated next action', true);
                break;
            case 'mute':
            case 'unmute':
                muteUnmuteMain();
                logActionMain('SIMULATE_MUTE', 'Simulated mute/unmute action', true);
                break;
            default:
                logActionMain('SIMULATE_ERROR', `Unknown action: ${action}`, true);
        }
    };
    
    // Force play function for external devices that need explicit user interaction bypass
    window.forcePlayMain = function() {
        videoMain.play().then(() => {
            logActionMain('FORCE_PLAY', 'Forced play successful - external device should now work', true);
            updateStatusMain();
        }).catch(err => {
            logActionMain('FORCE_PLAY_ERROR', `Force play failed: ${err.message}`, true);
        });
    };
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
        // Initialize Media Session first
        initializeMediaSessionMain();
        
        if (itemsMain.length > 0) {
            // Load first video and prepare for immediate external controls
            currentIndexMain = 0;
            itemsMain[0].classList.add('active');
            const firstItem = itemsMain[0];
            videoMain.src = firstItem.dataset.src;
            currentVideoStatusMain.textContent = firstItem.dataset.title;
            updateMediaSessionMetadataMain();
            
            // Update navigation buttons for initial state
            updateNavigationButtonsMain();
            
            // Ensure video is ready for immediate external device control
            videoMain.load();
            
            logActionMain('SYSTEM_INIT', `Playlist loaded with ${itemsMain.length} videos`);
            logActionMain('READY_FOR_DEVICE', 'External device controls ready - no click required');
        } else {
            logActionMain('INIT_ERROR', 'No videos found in playlist');
        }
        
        // Mark as initialized
        isInitializedMain = true;
        
        // Start status updates
        setInterval(updateStatusMain, 1000);
    });
</script>

</body>
</html>
